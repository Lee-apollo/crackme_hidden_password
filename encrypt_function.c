
#include <stdio.h>
#include <string.h>
#include <stdint.h>


int main()
{

    // Put here hex dump of a function
    unsigned char a_out[] = {
  0x55, 0x48, 0x89, 0xe5, 0x48, 0x89, 0x7d, 0xc8, 0x48, 0x89, 0x75, 0xc0,
  0x48, 0xb8, 0xe2, 0x53, 0xca, 0x58, 0xe1, 0xbc, 0xe0, 0xfb, 0x48, 0x89,
  0x45, 0xee, 0xc7, 0x45, 0xf6, 0xa7, 0xd4, 0xd8, 0x95, 0x66, 0xc7, 0x45,
  0xfa, 0x83, 0xb2, 0x48, 0xb8, 0x8a, 0x36, 0xa6, 0x34, 0x8e, 0xe3, 0x97,
  0x94, 0x48, 0x89, 0x45, 0xe0, 0xc7, 0x45, 0xe8, 0xd5, 0xb8, 0xbc, 0xca,
  0x66, 0xc7, 0x45, 0xec, 0xb7, 0x80, 0x48, 0xc7, 0x45, 0xd2, 0x00, 0x00,
  0x00, 0x00, 0xc7, 0x45, 0xda, 0x00, 0x00, 0x00, 0x00, 0x66, 0xc7, 0x45,
  0xde, 0x00, 0x00, 0x48, 0x83, 0x7d, 0xc0, 0x0e, 0x74, 0x07, 0xb8, 0x00,
  0x00, 0x00, 0x00, 0xeb, 0x5e, 0xc7, 0x45, 0xfc, 0x00, 0x00, 0x00, 0x00,
  0xeb, 0x48, 0x8b, 0x45, 0xfc, 0x48, 0x63, 0xd0, 0x48, 0x8b, 0x45, 0xc8,
  0x48, 0x01, 0xd0, 0x0f, 0xb6, 0x10, 0x8b, 0x45, 0xfc, 0x48, 0x98, 0x0f,
  0xb6, 0x44, 0x05, 0xee, 0x31, 0xc2, 0x8b, 0x45, 0xfc, 0x48, 0x98, 0x88,
  0x54, 0x05, 0xd2, 0x8b, 0x45, 0xfc, 0x48, 0x98, 0x0f, 0xb6, 0x54, 0x05,
  0xd2, 0x8b, 0x45, 0xfc, 0x48, 0x98, 0x0f, 0xb6, 0x44, 0x05, 0xe0, 0x38,
  0xc2, 0x74, 0x07, 0xb8, 0x00, 0x00, 0x00, 0x00, 0xeb, 0x11, 0x83, 0x45,
  0xfc, 0x01, 0x8b, 0x45, 0xfc, 0x83, 0xf8, 0x0d, 0x76, 0xb0, 0xb8, 0x01,
  0x00, 0x00, 0x00, 0x5d, 0xc3
    };

    // This is hardcoded checksum of password (hello_wolrd_42)
    // Calculated in python as:
    // >>> hex(sum([ord(char) * i for i, char in enumerate("hello_world_42")]) + 0x7FFFFFFF)
    // '0x8000203d'

    // Put here current checksum of the password
    uint32_t passwdChecksum = 0x8000203d;

    printf("Expected passwd checksum: %x\n", passwdChecksum);

    // Let's calculate a checksum of our function
    uint32_t codeChecksum = 0;
    for (int i = 0; i < sizeof(a_out); i++)
    {
        codeChecksum += a_out[i] * i;
    }

    printf("Expected code checksum: %x\n", codeChecksum);

    printf("Code start\n");

    for (int i = 0; i < sizeof(a_out); i++)
    {
        uint8_t decrypt_byte = (passwdChecksum  >> ((i % 4) * 8)) & 0xFF;
        //printf("Decrpyt byte: %x\n", decrypt_byte);
        //printf("byte: %x, data:0x%2x, \n", decrypt_byte, decrypt_byte ^ a_out[i]);  
        printf("0x%02x, ", decrypt_byte ^ a_out[i]);
    }

    printf("\nCode end\n");

    return 0;
}